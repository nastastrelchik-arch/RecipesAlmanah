{% extends 'base.html' %}

{% block title %}{{ recipe.title }} - –ö—É–ª–∏–Ω–∞—Ä–Ω—ã–π —Å–∞–π—Ç{% endblock %}

{% block content %}
<div class="row">
    <div class="col-md-8 mx-auto">
        <div class="card">
            <div class="card-header bg-success text-white">
                <h2 class="mb-0">{{ recipe.title }}</h2>
            </div>


            {% if recipe.main_photo %}
            <img src="{{ recipe.main_photo.url }}" class="card-img-top" alt="{{ recipe.title }}" style="max-height: 400px; object-fit: cover;">
            {% endif %}

            <div class="card-body">
                <div class="row mb-4">
                    <div class="col-md-6">
                        <p><strong>–ê–≤—Ç–æ—Ä:</strong> {{ recipe.author.username }}</p>
                        <p><strong>–í—Ä–µ–º—è –ø—Ä–∏–≥–æ—Ç–æ–≤–ª–µ–Ω–∏—è:</strong> {{ recipe.cooking_time }} –º–∏–Ω—É—Ç</p>
                        <p><strong>–ü–æ—Ä—Ü–∏–∏:</strong> {{ recipe.servings }}</p>
                    </div>
                    <div class="col-md-6">
                        <p><strong>–ö–∞–ª–æ—Ä–∏–π–Ω–æ—Å—Ç—å:</strong> {{ recipe.calories_per_100g }} –∫–∫–∞–ª/100–≥</p>
                        <p><strong>–°–ª–æ–∂–Ω–æ—Å—Ç—å:</strong> {{ recipe.get_difficulty_display }}</p>
                        <p><strong>–î–∞—Ç–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è:</strong> {{ recipe.created_at|date:"d.m.Y" }}</p>
                    </div>
                </div>

                <h5>–û–ø–∏—Å–∞–Ω–∏–µ</h5>
                <p class="mb-4">{{ recipe.description }}</p>

                {% if recipe.ingredients.all %}
                <h5>–ò–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã</h5>
                <ul class="list-group mb-4">
                    {% for ingredient in recipe.ingredients.all %}
                    <li class="list-group-item">{{ ingredient.name }} - {{ ingredient.quantity }}</li>
                    {% endfor %}
                </ul>
                {% endif %}

                {% if recipe.cooking_steps.all %}
<h5>–®–∞–≥–∏ –ø—Ä–∏–≥–æ—Ç–æ–≤–ª–µ–Ω–∏—è</h5>
<div class="mb-4">
    {% for step in recipe.cooking_steps.all %}
    <div class="card mb-3 border-0 shadow-sm">
        <div class="card-body p-0">
            <div class="row g-0">
                <!-- –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ - –Ω–∞ –¥–µ—Å–∫—Ç–æ–ø–µ —Å–ª–µ–≤–∞, –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö —Å–≤–µ—Ä—Ö—É -->
                <div class="col-md-4 position-relative order-md-1 order-2">
                    {% if step.photo %}
                    <div class="h-100 d-flex align-items-center justify-content-center bg-light rounded-start rounded-md-start-0 rounded-top-md p-2">
                        <img src="{{ step.photo.url }}" alt="–®–∞–≥ {{ step.step_number }}"
                             class="img-fluid rounded" style="max-height: 300px; width: auto; object-fit: contain;">
                    </div>
                    {% else %}
                    <div class="h-100 d-flex align-items-center justify-content-center bg-light rounded-start rounded-md-start-0 rounded-top-md text-muted p-3" style="min-height: 150px;">
                        <i class="fas fa-image fa-2x"></i>
                    </div>
                    {% endif %}
                    <!-- –ù–æ–º–µ—Ä —à–∞–≥–∞ –Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–∏ —Å –∑–µ–ª–µ–Ω—ã–º —Ñ–æ–Ω–æ–º -->
                    <div class="position-absolute top-0 start-0 bg-success text-white px-2 py-1 rounded-bottom-end">
                        –®–∞–≥ {{ step.step_number }}
                    </div>
                </div>
                <!-- –¢–µ–∫—Å—Ç - –Ω–∞ –¥–µ—Å–∫—Ç–æ–ø–µ —Å–ø—Ä–∞–≤–∞, –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö —Å–Ω–∏–∑—É -->
                <div class="col-md-8 d-flex align-items-center order-md-2 order-1">
                    <div class="p-3">
                        <p class="card-text mb-0">{{ step.description }}</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% endfor %}
</div>
{% endif %}

                {% if recipe.hashtags.all %}
            <div class="hashtags mt-2">
                {% for hashtag in recipe.hashtags.all %}
                    <span class="badge bg-secondary me-1">{{ hashtag.name }}</span>
                {% endfor %}
            </div>
            {% else %}
            <div class="hashtags mt-2">
                <small class="text-muted">–ù–µ—Ç —Ö–µ—à—Ç–µ–≥–æ–≤</small>
            </div>
            {% endif %}
            </div>

            <!-- –°–µ–∫—Ü–∏—è –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ -->
            <div class="row mt-4">
                <div class="col-12">
                    <div class="card comments-card">
                        <div class="card-header comments-header">
                            <h4 class="mb-0">
                                <i class="fas fa-comments me-2"></i>
                                –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏
                                <span class="badge comments-count">{{ recipe.comments.count }}</span>
                            </h4>
                        </div>

                        <div class="card-body p-0">
                            <!-- –§–æ—Ä–º–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è -->
                            {% if user.is_authenticated %}
                            <div class="comment-form">
                                <form method="post" action="{% url 'comments:add-comment' recipe.pk %}" enctype="multipart/form-data" id="commentForm">
                                    {% csrf_token %}

                                    <div class="mb-3">
                                        <label for="commentText" class="form-label">–î–æ–±–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π:</label>

                                        <!-- –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è -->
                                        <div class="d-flex gap-2 mb-2">
                                            <button type="button" class="btn btn-outline-secondary btn-sm" onclick="toggleEmojiPanel()">
                                                <i class="fas fa-smile"></i> –≠–º–æ–¥–∑–∏
                                            </button>
                                            <button type="button" class="btn btn-outline-info btn-sm" onclick="openImageDialog()">
                                                <i class="fas fa-image"></i> –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
                                            </button>
                                        </div>

                                        <!-- –ü–∞–Ω–µ–ª—å —ç–º–æ–¥–∑–∏ -->
                                        <div class="emoji-panel" id="emojiPanel" style="display: none;">
                                            <div class="emoji-category">
                                                <h6>–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ —ç–º–æ–¥–∑–∏</h6>
                                                <div class="emoji-grid" id="emojiGrid">
                                                    <!-- –≠–º–æ–¥–∑–∏ –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è —á–µ—Ä–µ–∑ JS -->
                                                </div>
                                            </div>
                                        </div>

                                        <textarea name="text" class="form-control" id="commentText" rows="3"
                                                  placeholder="–ü–æ–¥–µ–ª–∏—Ç–µ—Å—å –≤–∞—à–∏–º –º–Ω–µ–Ω–∏–µ–º –æ —Ä–µ—Ü–µ–ø—Ç–µ..."
                                                  maxlength="1000" required></textarea>
                                        <div class="form-text">–ú–∞–∫—Å–∏–º—É–º 1000 —Å–∏–º–≤–æ–ª–æ–≤</div>
                                    </div>

                                    <!-- –°–∫—Ä—ã—Ç–æ–µ –ø–æ–ª–µ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è -->
                                    <input type="file" name="image" id="commentImage" accept="image/*" style="display: none;">

                                    <!-- –ü—Ä–µ–≤—å—é –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è -->
                                    <div class="image-preview mb-3" id="imagePreview" style="display: none;">
                                        <div class="d-flex align-items-center gap-2 p-2 bg-light rounded">
                                            <img src="" alt="Preview" id="previewImage" style="max-width: 100px; max-height: 80px;">
                                            <div>
                                                <small class="text-muted">–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–ª—è –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è</small>
                                                <br>
                                                <button type="button" class="btn btn-outline-danger btn-sm mt-1" onclick="removeImage()">
                                                    <i class="fas fa-times"></i> –£–¥–∞–ª–∏—Ç—å
                                                </button>
                                            </div>
                                        </div>
                                    </div>

                                    <button type="submit" class="btn btn-success">
                                        <i class="fas fa-paper-plane me-1"></i>–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π
                                    </button>
                                </form>
                            </div>
                            {% else %}
                            <div class="alert alert-info m-3">
                                <i class="fas fa-info-circle me-2"></i>
                                <a href="{% url 'users:login' %}" class="alert-link">–í–æ–π–¥–∏—Ç–µ</a>, —á—Ç–æ–±—ã –æ—Å—Ç–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π
                            </div>
                            {% endif %}

                            <!-- –°–ø–∏—Å–æ–∫ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ -->
                            <div class="comments-list">
                                {% if recipe.comments.all %}
                                    {% for comment in recipe.comments.all %}
                                    <div class="comment-item">
                                        <div class="d-flex justify-content-between align-items-start mb-2">
                                            <div class="d-flex align-items-center">
                                                {% if comment.author.profile.profile_photo %}
                                                    <img src="{{ comment.author.profile.profile_photo.url }}"
                                                         alt="{{ comment.author.username }}"
                                                         class="comment-avatar me-2">
                                                {% else %}
                                                    <div class="avatar-placeholder me-2">
                                                        <i class="fas fa-user"></i>
                                                    </div>
                                                {% endif %}
                                                <div>
                                                    <h6 class="mb-0" style="font-size: 0.9rem;">{{ comment.author.username }}</h6>
                                                    <small class="comment-time">{{ comment.created_at|date:"d.m.Y H:i" }}</small>
                                                </div>
                                            </div>
                                            {% if user == comment.author or user.is_superuser %}
                                            <form method="post" action="{% url 'comments:delete-comment' comment.pk %}"
                                                  class="d-inline" onsubmit="return confirm('–£–¥–∞–ª–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π?');">
                                                {% csrf_token %}
                                                <button type="submit" class="btn btn-outline-danger btn-sm">
                                                    <i class="fas fa-trash"></i>
                                                </button>
                                            </form>
                                            {% endif %}
                                        </div>

                                        <div class="comment-content">
                                            <p class="comment-text">{{ comment.text|linebreaksbr }}</p>

                                            {% if comment.image %}
                                            <div class="comment-image mt-2">
                                                <img src="{{ comment.image.url }}" alt="–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∫ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—é"
                                                     class="img-fluid rounded" style="max-width: 300px;">
                                            </div>
                                            {% endif %}

                                            {% if comment.updated_at != comment.created_at %}
                                            <small class="comment-edited">
                                                <i class="fas fa-edit me-1"></i>–ò–∑–º–µ–Ω–µ–Ω: {{ comment.updated_at|date:"d.m.Y H:i" }}
                                            </small>
                                            {% endif %}
                                        </div>
                                    </div>
                                    {% endfor %}
                                {% else %}
                                    <div class="comments-empty">
                                        <i class="fas fa-comment-slash"></i>
                                        <p class="mb-0">–ü–æ–∫–∞ –Ω–µ—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤. –ë—É–¥—å—Ç–µ –ø–µ—Ä–≤—ã–º!</p>
                                    </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card-footer">
                <div class="btn-group">
                    <a href="{% url 'recipes:home' %}" class="btn btn-outline-secondary">–ù–∞–∑–∞–¥ –∫ —Ä–µ—Ü–µ–ø—Ç–∞–º</a>
                    {% if user.is_authenticated %}
                        <a href="{% url 'recipes:add-to-favorites' recipe.pk %}" class="btn btn-outline-primary">
                            {% if user in recipe.favorite_set.all %}–£–¥–∞–ª–∏—Ç—å –∏–∑ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ{% else %}–í –∏–∑–±—Ä–∞–Ω–Ω–æ–µ{% endif %}
                        </a>
                    {% endif %}
                    {% if user == recipe.author or user.is_superuser %}
                        <a href="{% url 'recipes:recipe-update' recipe.pk %}" class="btn btn-outline-warning">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</a>
                        <a href="{% url 'recipes:recipe-delete' recipe.pk %}" class="btn btn-outline-danger">–£–¥–∞–ª–∏—Ç—å</a>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>


    <!-- JavaScript –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —ç–º–æ–¥–∑–∏ –∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏ -->
<script>
function toggleEmojiPanel() {
    const panel = document.getElementById('emojiPanel');
    if (panel.style.display === 'none') {
        panel.style.display = 'block';
        // –ó–∞–ø–æ–ª–Ω—è–µ–º —ç–º–æ–¥–∑–∏ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –æ—Ç–∫—Ä—ã—Ç–∏–∏
        if (document.getElementById('emojiGrid').children.length === 0) {
            fillEmojiGrid();
        }
    } else {
        panel.style.display = 'none';
    }
}

function fillEmojiGrid() {
    const emojis = [
    // –°–º–∞–π–ª–∏–∫–∏ –∏ —ç–º–æ—Ü–∏–∏
    'üòÄ', 'üòÉ', 'üòÑ', 'üòÅ', 'üòÜ', 'üòÖ', 'üòÇ', 'ü§£', 'üòä', 'üòá',
    'üôÇ', 'üôÉ', 'üòâ', 'üòå', 'üòç', 'ü•∞', 'üòò', 'üòó', 'üòô', 'üòö',
    'üòã', 'üòõ', 'üòù', 'üòú', 'ü§™', 'ü§®', 'üßê', 'ü§ì', 'üòé', 'ü§©',
    'ü•≥', 'üòè', 'üòí', 'üòû', 'üòî', 'üòü', 'üòï', 'üôÅ', '‚òπÔ∏è', 'üò£',
    'üòñ', 'üò´', 'üò©', 'ü•∫', 'üò¢', 'üò≠', 'üò§', 'üò†', 'üò°', 'ü§¨',
    'ü§Ø', 'üò≥', 'ü•µ', 'ü•∂', 'üò±', 'üò®', 'üò∞', 'üò•', 'üòì', 'ü§ó',
    'ü§î', 'ü§≠', 'ü§´', 'ü§•', 'üò∂', 'üòê', 'üòë', 'üò¨', 'üôÑ', 'üòØ',
    'üò¶', 'üòß', 'üòÆ', 'üò≤', 'ü•±', 'üò¥', 'ü§§', 'üò™', 'üòµ', 'ü§ê',
    'ü•¥', 'ü§¢', 'ü§Æ', 'ü§ß', 'üò∑', 'ü§í', 'ü§ï', 'ü§ë', 'ü§†', 'üòà',

    // –°–µ—Ä–¥—Ü–∞
    '‚ù§Ô∏è', 'üß°', 'üíõ', 'üíö', 'üíô', 'üíú', 'üñ§', 'ü§ç', 'ü§é', 'üíî',
    '‚ù£Ô∏è', 'üíï', 'üíû', 'üíì', 'üíó', 'üíñ', 'üíò', 'üíù', 'üíü', '‚ô•Ô∏è',

    // –ñ–µ—Å—Ç—ã
    'üëç', 'üëé', 'üëå', 'ü§å', 'ü§è', '‚úåÔ∏è', 'ü§û', 'ü§ü', 'ü§ò', 'üëÜ',
    'üëá', 'üëà', 'üëâ', 'üñï', 'ü§ô', 'üëã', 'ü§ö', 'üñêÔ∏è', '‚úã', 'üññ',
    'üëè', 'üôå', 'üëê', 'ü§≤', 'ü§ù', 'üôè', '‚úçÔ∏è', 'üíÖ', 'ü§≥', 'üí™',

    // –ï–¥–∞ –∏ –Ω–∞–ø–∏—Ç–∫–∏
    'üçé', 'üçê', 'üçä', 'üçã', 'üçå', 'üçâ', 'üçá', 'üçì', 'ü´ê', 'üçà',
    'üçí', 'üçë', 'ü•≠', 'üçç', 'ü••', 'ü•ù', 'üçÖ', 'üçÜ', 'ü•ë', 'ü•¶',
    'ü•¨', 'ü•í', 'üå∂Ô∏è', 'ü´ë', 'üåΩ', 'ü•ï', 'ü´í', 'üßÑ', 'üßÖ', 'ü•î',
    'üç†', 'ü•ê', 'ü•Ø', 'üçû', 'ü•ñ', 'ü•®', 'üßÄ', 'ü•ö', 'üç≥', 'üßà',
    'ü•û', 'üßá', 'ü•ì', 'ü•©', 'üçó', 'üçñ', 'ü¶¥', 'üå≠', 'üçî', 'üçü',
    'üçï', 'ü´ì', 'ü•™', 'ü•ô', 'üßÜ', 'üåÆ', 'üåØ', 'ü´î', 'ü•ó', 'ü•ò',
    'ü´ï', 'ü•´', 'üçù', 'üçú', 'üç≤', 'üçõ', 'üç£', 'üç±', 'ü•ü', 'ü¶™',
    'üç§', 'üçô', 'üçö', 'üçò', 'üç•', 'ü•†', 'ü•Æ', 'üç¢', 'üç°', 'üçß',
    'üç®', 'üç¶', 'ü•ß', 'üßÅ', 'üç∞', 'üéÇ', 'üçÆ', 'üç≠', 'üç¨', 'üç´',
    'üçø', 'üç©', 'üç™', 'üå∞', 'ü•ú', 'üçØ', 'ü•õ', 'üçº', 'ü´ñ', '‚òï',
    'üçµ', 'üßÉ', 'ü•§', 'üßã', 'üç∂', 'üç∫', 'üçª', 'ü•Ç', 'üç∑', 'ü•É',
    'üç∏', 'üçπ', 'üßâ', 'üçæ', 'üßä', 'ü•Ñ', 'üç¥', 'üçΩÔ∏è', 'ü•£', 'ü•°',


    // –ü—Ä–∞–∑–¥–Ω–∏–∫–∏ –∏ —Å–æ–±—ã—Ç–∏—è
    'üéâ', 'üéä', 'üéÇ', 'üéÄ', 'üéÅ', 'üéà', 'üéÜ', 'üéá', '‚ú®', 'üéÉ',
    'üéÑ', 'üéã', 'üéç', 'üéé', 'üéè', 'üéê', 'üéë', 'üé´', 'üèÜ', 'ü•á',
    'ü•à', 'ü•â', 'üèÖ', 'üéñÔ∏è', 'üéóÔ∏è', 'üéüÔ∏è', 'üé≠', 'ü©∞', 'üé®', 'üé™',
    'üé§', 'üéß', 'üéº', 'üéπ', 'ü•Å', 'ü™ò', 'üé∑', 'üé∫', 'üé∏', 'ü™ï',
    'üéª', 'üé¨', 'üéÆ', 'üëæ', 'üéØ', 'üé≤', 'üé∞', 'üé≥', 'ü™Ä', 'ü™Å',


    // –°–∏–º–≤–æ–ª—ã –∏ –∑–Ω–∞–∫–∏
    'üî•', '‚≠ê', 'üåü', 'üí´', '‚ú®', 'üéØ', 'üí•', 'üí¶', 'üí®', 'üï≥Ô∏è',
    'üí£', 'üõ°Ô∏è', 'üîÆ', 'üéÅ', 'üéÄ', 'üéà', 'üéä', 'üéâ', 'üéÑ', 'üå™Ô∏è',
    'üåà', '‚òÄÔ∏è', 'üå§Ô∏è', '‚õÖ', 'üå•Ô∏è', '‚òÅÔ∏è', 'üå¶Ô∏è', 'üåßÔ∏è', '‚õàÔ∏è', 'üå©Ô∏è',
    'üå®Ô∏è', '‚òÉÔ∏è', '‚õÑ', 'üå¨Ô∏è', 'üí®', 'üíß', 'üí¶', '‚òî', '‚òÇÔ∏è', 'üåä',
];

    const grid = document.getElementById('emojiGrid');
    emojis.forEach(emoji => {
        const button = document.createElement('button');
        button.type = 'button';
        button.className = 'emoji-btn';
        button.textContent = emoji;
        button.onclick = function() {
            insertEmoji(emoji);
        };
        grid.appendChild(button);
    });
}

function insertEmoji(emoji) {
    const textarea = document.getElementById('commentText');
    const start = textarea.selectionStart;
    const end = textarea.selectionEnd;
    const text = textarea.value;
    textarea.value = text.substring(0, start) + emoji + text.substring(end);
    textarea.focus();
    textarea.selectionStart = textarea.selectionEnd = start + emoji.length;

    // –ó–∞–∫—Ä—ã–≤–∞–µ–º –ø–∞–Ω–µ–ª—å –ø–æ—Å–ª–µ –≤—ã–±–æ—Ä–∞
    document.getElementById('emojiPanel').style.display = 'none';
}

function openImageDialog() {
    // –ü—Ä–æ—Å—Ç–æ –∫–ª–∏–∫–∞–µ–º –ø–æ —Å–∫—Ä—ã—Ç–æ–º—É input file
    document.getElementById('commentImage').click();
}

// –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤—ã–±–æ—Ä–∞ —Ñ–∞–π–ª–∞
document.getElementById('commentImage').addEventListener('change', function(e) {
    const file = e.target.files[0];
    if (file) {
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ —ç—Ç–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
        if (!file.type.startsWith('image/')) {
            alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è!');
            return;
        }

        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–µ–≤—å—é
        const reader = new FileReader();
        reader.onload = function(e) {
            document.getElementById('previewImage').src = e.target.result;
            document.getElementById('imagePreview').style.display = 'block';
        };
        reader.readAsDataURL(file);
    }
});

function removeImage() {
    document.getElementById('commentImage').value = '';
    document.getElementById('imagePreview').style.display = 'none';
    document.getElementById('previewImage').src = '';
}

// –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–∞–Ω–µ–ª–∏ —ç–º–æ–¥–∑–∏ –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –µ—ë
document.addEventListener('click', function(e) {
    const panel = document.getElementById('emojiPanel');
    const button = document.querySelector('button[onclick="toggleEmojiPanel()"]');

    if (panel && panel.style.display === 'block' &&
        !panel.contains(e.target) &&
        e.target !== button &&
        !button.contains(e.target)) {
        panel.style.display = 'none';
    }
});
</script>
{% endblock %}

